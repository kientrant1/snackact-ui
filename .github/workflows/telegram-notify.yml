name: Telegram Notification

on:
  workflow_call:
    inputs:
      pkg_name:
        required: true
        type: string
      pkg_version:
        required: true
        type: string
    secrets:
      TELEGRAM_BOT_TOKEN:
        required: true
      TELEGRAM_CHAT_ID:
        required: true

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send Telegram notification
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          PKG_NAME: ${{ inputs.pkg_name }}
          PKG_VERSION: ${{ inputs.pkg_version }}
        run: |
          TEXT="ðŸ“¦ Published ${PKG_NAME} v${PKG_VERSION} to npm%0AðŸ”— https://www.npmjs.com/package/${PKG_NAME}"

          curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -d chat_id="${TELEGRAM_CHAT_ID}" \
            -d text="${TEXT}"
